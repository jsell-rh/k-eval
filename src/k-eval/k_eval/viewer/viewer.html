<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>k-eval Viewer</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="https://unpkg.com/marked@9/marked.min.js"></script>
<style>
/* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

/* â”€â”€ Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  /* Page backgrounds â€” spread further apart so cards read as distinct */
  --bg:        #07080f;
  --s1:        #0e1120;   /* cards / panels â€” noticeably lighter than page */
  --s2:        #141828;   /* resp-block / claims-cell â€” one more step up */
  --s3:        #1a1f35;   /* judge section band */

  /* Borders â€” more visible */
  --border:    #252a40;
  --border-l:  #363d5c;

  /* Text â€” lifted for WCAG AA compliance */
  --text:      #eceef6;   /* primary */
  --text-2:    #a8b2cc;   /* secondary body â€” up from #8892b0 */
  --text-m:    #6b7899;   /* muted labels â€” up from #4a5070 */

  --accent:    #5b7cf6;
  --amber:     #f59e0b;
  --green:     #34d399;
  --yellow:    #fbbf24;
  --red:       #f87171;

  /* condition palette â€” first 8 cover typical use */
  --c0: #6b7280; --c1: #5b7cf6; --c2: #8b5cf6; --c3: #10b981;
  --c4: #f59e0b; --c5: #ec4899; --c6: #ef4444; --c7: #06b6d4;

  --radius: 5px;
  --font: Inter, system-ui, -apple-system, "Segoe UI", sans-serif;
  --mono: "JetBrains Mono", "Fira Code", ui-monospace, monospace;
  --hh: 48px;
}

html, body { height: 100%; }
body {
  font-family: var(--font);
  font-size: 15px;
  line-height: 1.55;
  color: var(--text);
  background: var(--bg);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-l); border-radius: 3px; }

/* â”€â”€ Tooltips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tt { position: relative; display: inline-flex; align-items: center; }
.tt-body {
  position: absolute;
  bottom: calc(100% + 7px);
  left: 50%;
  transform: translateX(-50%);
  background: #060810;
  border: 1px solid var(--border-l);
  border-radius: var(--radius);
  padding: 6px 10px;
  font-size: 12px;
  line-height: 1.5;
  color: var(--text-2);
  white-space: normal;
  width: max-content;
  max-width: 260px;
  pointer-events: none;
  opacity: 0;
  transition: opacity .12s ease;
  z-index: 9000;
  box-shadow: 0 4px 16px rgba(0,0,0,.5);
  text-align: left;
}
/* Only show the DIRECTLY hovered .tt's tooltip, not ancestors */
.tt:hover > .tt-body { opacity: 1; }
/* flip down near viewport top */
.tt-down .tt-body { bottom: auto; top: calc(100% + 7px); }
/* horizontal edge anchoring â€” pin to left or right of trigger instead of centering */
.tt-right .tt-body { left: auto; right: 0; transform: none; }
.tt-left  .tt-body { left: 0;    transform: none; }

/* â”€â”€ App shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app { display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

/* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#hdr {
  height: var(--hh);
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 12px;
  flex-shrink: 0;
  z-index: 100;
}

/* Brand â€” interactive when data is loaded */
.brand {
  font-weight: 700;
  font-size: 1rem;
  background: none;
  border: none;
  color: var(--text);
  font-family: var(--font);
  padding: 4px 6px;
  border-radius: var(--radius);
  transition: color .12s, background .12s;
  line-height: 1;
}
.brand.clickable {
  cursor: pointer;
}
.brand.clickable:hover {
  color: var(--accent);
  background: rgba(91,124,246,.1);
}
.brand.static {
  cursor: default;
}

.hdr-divider { width: 1px; height: 20px; background: var(--border-l); flex-shrink: 0; }
.eval-n { font-size: .9rem; color: var(--text-2); overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 280px; }
.hdr-sp { flex: 1; }

/* Primary nav â€” moved left, next to brand */
.seg {
  display: flex;
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 3px;
  gap: 2px;
}
.seg-btn {
  padding: 6px 18px;
  border: none;
  border-radius: 4px;
  background: transparent;
  color: var(--text-m);
  font-size: .875rem;
  font-weight: 500;
  cursor: pointer;
  font-family: var(--font);
  transition: background .12s, color .12s;
}
.seg-btn:hover { color: var(--text); }
.seg-btn.on    { background: var(--border); color: var(--text); }

/* Header breadcrumb â€” shown when a sample is selected in Samples view */
.hdr-crumb {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: .82rem;
  color: var(--text-m);
  overflow: hidden;
  flex-shrink: 1;
  min-width: 0;
}
.hdr-crumb-sep { color: var(--border-l); flex-shrink: 0; }
.hdr-crumb-q {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  color: var(--text-2);
  font-size: .82rem;
}

/* Keyboard shortcut badge */
.kbd-hint {
  font-size: .72rem;
  color: var(--text-m);
  background: var(--s1);
  border: 1px solid var(--border-l);
  border-radius: 3px;
  padding: 1px 5px;
  font-family: var(--mono);
  flex-shrink: 0;
}

/* â”€â”€ Views â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.view { display: none; flex: 1; min-height: 0; overflow: hidden; }
.view.on { display: flex; }

/* â”€â”€ Load view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#v-load {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
}
#v-load.drag-over { outline: 2px inset var(--accent); }
.load-shelf {
  display: flex;
  align-items: center;
  gap: 16px;
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px 22px;
  width: 440px;
}
.load-icon { font-size: 1.8rem; flex-shrink: 0; }
.load-copy  { flex: 1; }
.load-copy h2 { font-size: .95rem; font-weight: 600; }
.load-copy p  { font-size: .8rem; color: var(--text-2); margin-top: 2px; }
.load-btn {
  padding: 9px 18px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: var(--radius);
  font-size: .82rem;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  font-family: var(--font);
  flex-shrink: 0;
}
.load-btn:hover { opacity: .87; }
.load-err { color: var(--red); font-size: .82rem; }
.load-msg { color: var(--text-m); font-size: .82rem; }

/* â”€â”€ Overview view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#v-ov { flex-direction: column; overflow-y: auto; padding: 28px 36px; gap: 28px; }
.ov-meta { font-size: .875rem; color: var(--text-m); display: flex; flex-wrap: wrap; align-items: center; gap: 0; }
.ov-cost-chip strong { color: var(--amber); }

.sec-hdr {
  font-size: .75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .1em;
  color: var(--text-2);   /* lifted from --text-m for legibility */
  margin-bottom: 14px;
}

/* Ranking */
.rank-list  { display: flex; flex-direction: column; gap: 10px; }
.rank-hdr   { display: flex; align-items: center; gap: 12px; padding-bottom: 4px; border-bottom: 1px solid var(--border); }
.rank-hdr-spacer { flex: 1; }
.rank-hdr-score  { font-size: .68rem; font-weight: 700; letter-spacing: .08em; text-transform: uppercase; color: var(--text-m); width: 40px; text-align: right; }
.rank-hdr-cost   { font-size: .68rem; font-weight: 700; letter-spacing: .08em; text-transform: uppercase; color: var(--amber); width: 72px; text-align: right; }
.rank-row  { display: flex; align-items: center; gap: 12px; }
.rank-pos  { font-family: var(--mono); font-size: .8rem; color: var(--text-m); width: 18px; text-align: right; flex-shrink: 0; }
.rank-name { width: 200px; font-size: .9rem; font-weight: 500; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; flex-shrink: 0; }
.rank-track { flex: 1; height: 10px; background: var(--border); border-radius: 2px; overflow: hidden; }
.rank-fill  { height: 100%; border-radius: 2px; }
.rank-val   { font-family: var(--mono); font-size: .875rem; color: var(--text-2); width: 40px; text-align: right; flex-shrink: 0; }
.rank-cost  { font-family: var(--mono); font-size: .875rem; color: var(--amber); width: 72px; text-align: right; flex-shrink: 0; }
.rank-eff-val  { color: var(--text-2); }
.rank-eff-best { color: var(--green); font-weight: 700; }

/* Metric grid â€” 4 columns when cost card present */
.metric-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; }
.metric-grid.with-cost { grid-template-columns: repeat(3,1fr) 1.1fr; }
.metric-card {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px 16px;
}
.mc-title { font-size: .75rem; font-weight: 700; text-transform: uppercase; letter-spacing: .07em; color: var(--text-m); margin-bottom: 12px; }
.mc-rows  { display: flex; flex-direction: column; gap: 8px; }
.mc-row   { display: flex; align-items: center; gap: 8px; }
.mc-name  { font-size: .85rem; flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.mc-track { width: 80px; height: 6px; background: var(--border); border-radius: 2px; overflow: hidden; flex-shrink: 0; }
.mc-fill  { height: 100%; border-radius: 2px; }
.mc-val   { font-family: var(--mono); font-size: .85rem; width: 32px; text-align: right; }

/* Top samples table */
.inv-tbl  { width: 100%; border-collapse: collapse; }
.inv-tbl th { font-size: .72rem; font-weight: 700; text-transform: uppercase; letter-spacing: .08em; color: var(--text-m); padding: 7px 12px; border-bottom: 1px solid var(--border); text-align: left; }
.inv-tbl td { padding: 12px 12px; border-bottom: 1px solid var(--border); font-size: .9rem; }
.inv-tbl tr:hover td { background: var(--s1); cursor: pointer; }
.inv-idx   { font-family: var(--mono); color: var(--text-m); }
.inv-q     { color: var(--text-2); max-width: 500px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.inv-delta { font-family: var(--mono); color: var(--amber); text-align: right; }
.ov-all-link {
  background: none; border: none; color: var(--text-m); font-size: .875rem; cursor: pointer;
  margin-top: 12px; font-family: var(--font); padding: 0;
}
.ov-all-link:hover { color: var(--text); }

/* â”€â”€ Samples view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#v-smp { flex-direction: row; min-height: 0; }

/* List panel */
#lst-panel {
  width: 300px;
  flex-shrink: 0;
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  background: var(--bg);
  overflow: hidden;
  min-height: 0;
  transition: width 0.2s ease;
  position: relative;
}
#lst-panel.collapsed {
  width: 32px;
  min-width: 32px;
}

/* Collapse toggle button â€” always visible at top of panel */
.lst-collapse-btn {
  position: absolute;
  top: 8px;
  right: 6px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--s1);
  border: 1px solid var(--border-l);
  border-radius: 3px;
  color: var(--text-m);
  font-size: .85rem;
  cursor: pointer;
  z-index: 10;
  flex-shrink: 0;
  transition: color .12s, background .12s;
  font-family: var(--font);
  line-height: 1;
  padding: 0;
}
.lst-collapse-btn:hover { color: var(--text); background: var(--border); }

/* Vertical label shown when collapsed */
.lst-collapsed-label {
  display: none;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  font-size: .72rem;
  color: var(--text-m);
  letter-spacing: .08em;
  text-transform: uppercase;
  margin-top: 48px;
  padding-left: 8px;
  user-select: none;
  white-space: nowrap;
}
#lst-panel.collapsed .lst-collapsed-label { display: block; }
#lst-panel.collapsed .lst-toolbar,
#lst-panel.collapsed .lst-count,
#lst-panel.collapsed #smp-list { visibility: hidden; }

.lst-toolbar {
  padding: 8px 12px;
  padding-right: 32px; /* space for collapse btn */
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}
.lst-lbl { font-size: .78rem; color: var(--text-m); white-space: nowrap; }
.lst-sel {
  flex: 1;
  background: var(--s1);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: var(--radius);
  padding: 4px 6px;
  font-size: .85rem;
  font-family: var(--font);
  cursor: pointer;
}
.lst-count { padding: 5px 12px; font-size: .78rem; color: var(--text-m); border-bottom: 1px solid var(--border); flex-shrink: 0; }
#smp-list { flex: 1; overflow-y: auto; }

.smp-row {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 0 12px;
  height: 46px;
  cursor: pointer;
  border-bottom: 1px solid var(--border);
  transition: background .1s;
  user-select: none;
}
.smp-row:hover    { background: #141828; }
/* Selected row: strong left accent bar + noticeably different background */
.smp-row.on       {
  background: #1c2340;
  border-left: 3px solid var(--accent);
  padding-left: 9px;
  box-shadow: inset 0 0 0 1px rgba(91,124,246,.18);
}
.smp-row.on .smp-q   { color: var(--text); }     /* selected question fully bright */
.smp-row.on .smp-idx { color: var(--text-2); }   /* selected index slightly lifted */
/* Bullet â€” slightly larger for better visibility */
.smp-bullet       { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.smp-idx          { font-family: var(--mono); font-size: .82rem; color: var(--text-m); width: 30px; flex-shrink: 0; }
.smp-q            { flex: 1; font-size: .85rem; color: var(--text-2); overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.smp-delta        { font-family: var(--mono); font-size: .78rem; color: var(--text-m); flex-shrink: 0; }

/* Detail panel */
#det-panel {
  flex: 1;
  overflow-y: auto;
  padding: 24px 32px 40px;
  min-width: 0;
  min-height: 0;
}
.det-empty {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-m);
  font-size: .9rem;
}

/* Back-to-overview link in detail panel */
.det-back {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: .8rem;
  color: var(--text-m);
  background: none;
  border: none;
  cursor: pointer;
  font-family: var(--font);
  padding: 0;
  margin-bottom: 16px;
  transition: color .12s;
}
.det-back:hover { color: var(--accent); }

/* â”€â”€ Section A: Question + Reference â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sec-qa { padding-bottom: 20px; border-bottom: 2px solid var(--border-l); margin-bottom: 22px; }
.qa-lbl { font-size: .75rem; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--text-m); margin-bottom: 6px; }
.qa-q   { font-size: 1.05rem; font-weight: 600; color: var(--text); line-height: 1.55; }
.qa-ref { margin-top: 10px; }
.qa-ref-text {
  font-size: .85rem;
  color: var(--text-2);
  font-style: italic;
  line-height: 1.65;
  background: var(--s2);
  border: 1px solid var(--border-l);
  border-radius: var(--radius);
  padding: 10px 14px;
  margin-top: 5px;
}
.ref-toggle {
  font-size: .78rem; color: var(--text-m); background: none; border: none;
  cursor: pointer; font-family: var(--font); padding: 0;
}
.ref-toggle:hover { color: var(--text); }

/* â”€â”€ Section B: Aggregate score grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sec-scores { margin-bottom: 8px; }  /* judge-section provides 24px top margin */
.score-grid { display: grid; gap: 10px; }
.score-col {
  border-top: 4px solid var(--border-l);   /* thicker top bar */
  background: var(--s1);
  border-radius: 0 0 var(--radius) var(--radius);
  padding: 12px 14px;
  cursor: pointer;
  transition: background .12s;
}
.score-col:hover { background: #13172a; }
/* Selected column: visible background lift + 2px accent outline */
.score-col.on    {
  background: #1a2040;
  outline: 2px solid var(--accent);
  outline-offset: -1px;
  border-top-width: 4px;
}
.sc-name {
  font-size: .75rem; font-weight: 700; text-transform: uppercase; letter-spacing: .06em;
  margin-bottom: 8px; display: flex; align-items: center; gap: 5px;
  overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
}
.sc-star { color: var(--amber); }
.sc-comp { font-size: 1.8rem; font-weight: 700; font-family: var(--mono); line-height: 1; margin-bottom: 10px; }
.sc-metrics { display: flex; flex-direction: column; gap: 4px; }
.sc-m-row { display: flex; align-items: center; gap: 6px; }
.sc-m-lbl { font-size: .8rem; color: var(--text-2); width: 58px; flex-shrink: 0; }
.sc-m-track { flex: 1; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.sc-m-fill  { height: 100%; border-radius: 2px; }
.sc-m-val   { font-family: var(--mono); font-size: .8rem; min-width: 42px; text-align: right; flex-shrink: 0; }

.spread-line {
  margin-top: 10px; margin-bottom: 4px;
  font-size: .78rem; color: var(--text-2);  /* slightly brighter */
  display: flex; align-items: center; gap: 6px;
}
.spread-val { font-family: var(--mono); color: var(--text); }

/* â”€â”€ Section C: Condition + Rep nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cond-tabs {
  display: flex;
  flex-wrap: wrap;
  border-bottom: 2px solid var(--border);
  margin-bottom: 0;
  gap: 0;
}
.cond-tab {
  padding: 9px 16px;
  font-size: .85rem;
  color: var(--text-m);
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  white-space: nowrap;
  transition: color .12s;
  user-select: none;
}
.cond-tab:hover { color: var(--text-2); }
.cond-tab.on    { color: var(--text); border-bottom-color: var(--accent); font-weight: 600; }

/* Rep tabs â€” span the full width of the section above the split */
.rep-tabs {
  display: flex;
  gap: 4px;
  padding: 7px 14px;
  align-items: center;
  border-bottom: 1px solid var(--border);
}
.rep-tab {
  padding: 3px 12px;
  font-size: .75rem;
  color: var(--text-m);
  cursor: pointer;
  border-radius: 3px;
  border: 1px solid transparent;
  transition: background .1s, color .1s;
  user-select: none;
  font-family: var(--font);
}
.rep-tab:hover { color: var(--text-2); border-color: var(--border); }
.rep-tab.on    { color: var(--text); background: var(--border); border-color: var(--border-l); }
.rep-lbl { font-size: .7rem; color: var(--text-m); margin-right: 4px; }

/* â”€â”€ Judge section wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.judge-section {
  background: var(--s3);
  border: 1px solid var(--border-l);
  border-radius: var(--radius);
  margin-top: 24px;
  overflow: hidden;
}
.judge-section .cond-tabs {
  background: var(--s3);
  border-bottom-color: var(--border-l);
}
.judge-section .rep-tabs {
  background: var(--s3);
}

/* â”€â”€ Section D: Side-by-side split layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.flow-card {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
  min-height: 0;
}

/* Left column â€” agent response */
.flow-left {
  padding: 14px;
  border-right: 1px solid var(--border-l);
  background: var(--bg);
  display: flex;
  flex-direction: column;
  min-width: 0;
}

/* Right column â€” judge metrics */
.flow-right {
  padding: 14px;
  background: var(--bg);
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-width: 0;
}

/* Response block */
.resp-block {
  background: var(--s2);
  border: 1px solid var(--border-l);
  border-radius: var(--radius);
  padding: 14px 16px;
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
}
.resp-hdr {
  display: flex; justify-content: space-between; align-items: center;
  padding-bottom: 10px;
  margin-bottom: 12px;
  border-bottom: 1px solid var(--border-l);
  flex-shrink: 0;
}
.resp-lbl {
  font-size: .7rem; font-weight: 700; text-transform: uppercase; letter-spacing: .12em; color: var(--text-m);
  display: flex; align-items: center; gap: 8px;
}
.resp-lbl::before {
  content: '';
  display: block;
  width: 3px; height: 12px;
  background: var(--accent);
  border-radius: 2px;
  flex-shrink: 0;
}
.resp-rep-lbl { font-size: .8rem; color: var(--text-m); font-family: var(--mono); }
.resp-body {
  font-size: 13px;
  color: var(--text-2);
  white-space: pre-wrap;
  line-height: 1.7;
  max-height: 480px;
  overflow-y: auto;
  font-family: var(--mono);
  flex: 1;
}
.resp-body.expanded { max-height: none; }
.resp-expand-btn {
  margin-top: 6px;
  font-size: .75rem; color: var(--text-m); background: none; border: none;
  cursor: pointer; font-family: var(--font); padding: 0;
  flex-shrink: 0;
}
.resp-expand-btn:hover { color: var(--text); }
.resp-footer {
  margin-top: 8px;
  padding-top: 8px;
  border-top: 1px solid var(--border);
  display: flex; gap: 14px;
  font-size: .75rem; color: var(--text-m);
  flex-shrink: 0;
}
.resp-footer span { white-space: nowrap; }

/* Judge panel header â€” compact label row above metric blocks */
.judge-panel-hdr {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: .7rem;
  font-weight: 700;
  letter-spacing: .12em;
  text-transform: uppercase;
  color: var(--text-m);
  flex-shrink: 0;
  margin-bottom: 2px;
}
.judge-panel-hdr::before {
  content: '';
  display: block;
  width: 3px;
  height: 12px;
  background: var(--accent);
  border-radius: 2px;
  flex-shrink: 0;
}

/* Metric reasoning blocks */
.metric-block {
  border: 1px solid var(--border-l);
  border-radius: var(--radius);
  padding: 10px 14px;
  background: var(--s2);
  flex-shrink: 0;
}
.mb-hdr {
  display: flex; align-items: center; gap: 8px;
  margin-bottom: 4px;   /* tight â€” hdr and text are one visual unit */
}
.mb-name  {
  font-size: .75rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: var(--text-2);
  flex: 1;
}
.mb-track { width: 64px; height: 5px; background: var(--border); border-radius: 2px; overflow: hidden; flex-shrink: 0; }
.mb-fill  { height: 100%; border-radius: 2px; }
.mb-mean  { font-family: var(--mono); font-size: .82rem; }
.mb-std   { font-family: var(--mono); font-size: .75rem; color: var(--text-m); }
.mb-text  { font-size: 13px; color: var(--text-2); line-height: 1.7; white-space: pre-wrap; }

/* â”€â”€ Section E: Unverified claims â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sec-claims { margin-top: 28px; }
.claims-grid { display: grid; gap: 1px; background: var(--border-l); border: 1px solid var(--border-l); border-radius: var(--radius); overflow: hidden; }
.claims-cell { background: var(--s2); padding: 12px; }
.claims-cond { font-size: .75rem; font-weight: 700; text-transform: uppercase; letter-spacing: .06em; margin-bottom: 8px; }
.claim-item  { border-left: 3px solid var(--amber); padding: 4px 8px; font-size: .82rem; color: var(--text-2); line-height: 1.5; margin-bottom: 4px; }
.claim-item:last-child { margin-bottom: 0; }
.claims-none { font-size: .82rem; color: var(--text-m); }

/* â”€â”€ Score color utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.s-g { color: var(--green); }
.s-y { color: var(--yellow); }
.s-r { color: var(--red); }

/* â”€â”€ Markdown toggle button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.md-toggle {
  font-size: .7rem;
  color: var(--text-m);
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: 3px;
  padding: 2px 7px;
  cursor: pointer;
  font-family: var(--mono);
  transition: color .12s, border-color .12s;
  flex-shrink: 0;
}
.md-toggle:hover { color: var(--text-2); border-color: var(--border-l); }
.md-toggle.on    { color: var(--accent); border-color: var(--accent); }

/* â”€â”€ Markdown prose (scoped under .md-body) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.md-body {
  font-size: 14px;
  color: var(--text-2);
  line-height: 1.8;
  min-width: 0;
  /* BFC: prevents margin collapse swallowing heading top margins */
  display: flow-root;
}
.md-body p               { margin: 0 0 1em; }
.md-body p:last-child    { margin-bottom: 0; }
/* Use lobotomised owl for heading spacing â€” guarantees gap regardless of collapse */
.md-body * + h1, .md-body * + h2, .md-body * + h3,
.md-body * + h4, .md-body * + h5, .md-body * + h6 { margin-top: 1.6em; }
.md-body h1, .md-body h2, .md-body h3,
.md-body h4, .md-body h5, .md-body h6 {
  color: var(--text);
  font-weight: 600;
  margin-bottom: .55em;
  line-height: 1.3;
}
.md-body h1 { font-size: 1.2em; }
.md-body h2 { font-size: 1.1em; }
.md-body h3, .md-body h4 { font-size: 1em; }
.md-body ul, .md-body ol { padding-left: 1.6em; margin: .25em 0 1.1em; }
.md-body li              { margin-bottom: .55em; line-height: 1.7; }
.md-body li:last-child   { margin-bottom: 0; }
.md-body code {
  font-family: var(--mono);
  font-size: .875em;
  background: #1e2540;
  border: 1px solid #2e3558;
  border-radius: 3px;
  padding: 2px 6px;
  color: #c9d1e8;
}
.md-body pre {
  background: #111827;
  border: 1px solid #252d42;
  border-left: 3px solid var(--accent);
  border-radius: 0 var(--radius) var(--radius) 0;
  padding: 12px 16px;
  overflow-x: auto;
  margin: 1em 0 1.2em;
  line-height: 1.6;
}
.md-body pre code {
  background: none;
  border: none;
  padding: 0;
  font-size: .875em;
  color: #b0bdd6;
  border-radius: 0;
}
.md-body blockquote {
  border-left: 3px solid var(--border-l);
  padding-left: 10px;
  color: var(--text-m);
  margin: .5em 0;
}
.md-body a       { color: var(--accent); text-decoration: none; }
.md-body a:hover { text-decoration: underline; }
.md-body strong  { color: var(--text); font-weight: 600; }
.md-body em      { color: var(--text-2); }
.md-body hr      { border: none; border-top: 1px solid var(--border); margin: 1em 0; }
.md-body table   { border-collapse: collapse; width: 100%; margin-bottom: .75em; font-size: .9em; }
.md-body th, .md-body td { border: 1px solid var(--border); padding: 5px 10px; text-align: left; }
.md-body th      { background: var(--s1); color: var(--text); font-weight: 600; }

/* When md-body is inside resp-body (scrollable container), size to content */
.resp-body.md-mode { white-space: normal; font-family: var(--font); flex: none; }

/* â”€â”€ Load-another button (header) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hdr-load-btn {
  font-size: .78rem;
  color: var(--text-m);
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 4px 10px;
  cursor: pointer;
  font-family: var(--font);
  transition: color .12s, border-color .12s;
  white-space: nowrap;
  flex-shrink: 0;
}
.hdr-load-btn:hover { color: var(--text); border-color: var(--border-l); }
</style>
</head>
<body>
<div id="app">

<!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header id="hdr">
  <!-- Brand: clickable when loaded (navigates to Overview), static otherwise -->
  <button
    class="brand"
    :class="loaded ? 'clickable' : 'static'"
    @click="loaded && (view = 'ov')"
    :title="loaded ? 'Back to Overview' : 'k-eval'"
    :aria-label="loaded ? 'k-eval â€” back to Overview' : 'k-eval'"
  >k-eval</button>

  <!-- Primary nav â€” anchored left, next to brand -->
  <div class="seg" v-if="loaded">
    <button class="seg-btn" :class="{on: view==='ov'}"  @click="view='ov'">Overview</button>
    <button class="seg-btn" :class="{on: view==='smp'}" @click="view='smp'">Samples</button>
  </div>

  <!-- Eval name + optional sample breadcrumb -->
  <template v-if="loaded">
    <div class="hdr-divider"></div>
    <span class="eval-n">{{ evalName }}</span>
    <template v-if="view === 'smp' && selIdx">
      <span class="hdr-crumb-sep">â€º</span>
      <span class="hdr-crumb-q">#{{ selIdx }} Â· {{ selQ }}</span>
    </template>
  </template>

  <div class="hdr-sp"></div>



  <!-- Load another file â€” always accessible once data is loaded -->
  <template v-if="loaded">
    <button class="hdr-load-btn" @click="$refs.fiHdr.click()" title="Load a different .detailed.jsonl file">Open fileâ€¦</button>
    <input ref="fiHdr" type="file" accept=".jsonl,.json" style="display:none" @change="onFile">
  </template>
</header>

<!-- â”€â”€ Load view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="v-load" class="view" :class="{on: !loaded, 'drag-over': dragging}"
     @dragover.prevent="dragging=true" @dragleave="dragging=false" @drop.prevent="onDrop">
  <div class="load-shelf">
    <div class="load-icon">ğŸ“Š</div>
    <div class="load-copy">
      <h2>k-eval Viewer</h2>
      <p>Drop a <code>.detailed.jsonl</code> anywhere, or browse.</p>
    </div>
    <button class="load-btn" @click="$refs.fi.click()">Choose file</button>
    <input ref="fi" type="file" accept=".jsonl,.json" style="display:none" @change="onFile">
  </div>
  <p class="load-err" v-if="loadErr">{{ loadErr }}</p>
  <p class="load-msg" v-if="loadMsg">{{ loadMsg }}</p>
</div>

<!-- â”€â”€ Overview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="v-ov" class="view" :class="{on: loaded && view==='ov'}">

  <p class="ov-meta">
    {{ sampleIds.length }} samples &nbsp;Â·&nbsp;
    {{ conditions.length }} conditions &nbsp;Â·&nbsp;
    {{ repCount }} reps each &nbsp;Â·&nbsp;
    <span class="tt tt-down">
      agent: {{ modelId }}
      <span class="tt-body">LLM model used by the agent across all conditions and repetitions.</span>
    </span>
    &nbsp;Â·&nbsp;
    <span class="tt tt-down ov-cost-chip">
      agent cost:&nbsp;<strong>{{ fmtCost(totalCost) }}</strong>
      <span class="tt-body">Agent LLM API costs across all samples, conditions, and repetitions. Does not include judge LLM costs.</span>
    </span>
  </p>

  <!-- Ranking -->
  <div>
    <div class="sec-hdr">Condition Ranking &nbsp;Â·&nbsp; composite mean (1â€“5)</div>
    <div class="rank-list">
      <!-- Column headers -->
      <div class="rank-hdr">
        <span style="width:18px;flex-shrink:0"></span>
        <span style="width:200px;flex-shrink:0"></span>
        <span class="rank-hdr-spacer"></span>
        <span class="rank-hdr-score">Score</span>
        <span class="rank-hdr-cost tt tt-down">Agent cost<span class="tt-body">Agent LLM API cost for this condition. Does not include judge LLM costs.</span></span>
      </div>
      <div class="rank-row" v-for="(r,i) in condRanking" :key="r.cond">
        <span class="rank-pos">{{ i+1 }}.</span>
        <span class="rank-name tt" :style="{color: cc(r.cond)}">
          {{ r.cond }}
          <span class="tt-body">{{ r.cond }}: {{ r.mean.toFixed(3) }} composite mean across {{ sampleIds.length }} samples Ã— {{ repCount }} reps.</span>
        </span>
        <div class="rank-track">
          <div class="rank-fill" :style="{width: bp(r.mean)+'%', background: cc(r.cond)}"></div>
        </div>
        <span class="rank-val">{{ r.mean.toFixed(2) }}</span>
        <span class="rank-cost tt tt-down tt-right">
          {{ fmtCost(costByCond[r.cond]) }}
          <span class="tt-body">Total cost for {{ r.cond }}: {{ fmtCost(costByCond[r.cond]) }}<br>{{ pctOfTotal(r.cond) }}% of total spend.</span>
        </span>
      </div>
    </div>
  </div>

  <!-- Metric breakdown -->
  <div>
    <div class="sec-hdr">Per-Metric Breakdown</div>
    <div class="metric-grid with-cost">
      <div class="metric-card" v-for="m in METRICS" :key="m.key">
        <div class="mc-title tt tt-down">
          {{ m.label }}
          <span class="tt-body">{{ m.def }}</span>
        </div>
        <div class="mc-rows">
          <div class="mc-row" v-for="r in condRanking" :key="r.cond">
            <span class="mc-name" :style="{color: cc(r.cond)}" :title="r.cond">{{ r.cond }}</span>
            <div class="mc-track">
              <div class="mc-fill" :style="{width: bp(ovMetric(r.cond, m.key))+'%', background: cc(r.cond)}"></div>
            </div>
            <span class="mc-val" :class="sc(ovMetric(r.cond, m.key))">{{ ovMetric(r.cond, m.key).toFixed(2) }}</span>
          </div>
        </div>
      </div>
      <!-- Cost & Efficiency card -->
      <div class="metric-card" style="border-color: rgba(245,158,11,.25);">
        <div class="mc-title tt tt-down" style="color:var(--amber)">Agent Cost &amp; Efficiency<span class="tt-body">Agent LLM API costs only. Does not include judge LLM costs.</span></div>
        <div class="mc-rows">
          <div class="mc-row" v-for="r in condRanking" :key="r.cond">
            <span class="mc-name tt" :style="{color: cc(r.cond)}" :title="r.cond">{{ r.cond }}
              <span class="tt-body">{{ fmtCost(costByCond[r.cond]) }} Â· {{ pctOfTotal(r.cond) }}% of total spend</span>
            </span>
            <div class="mc-track">
              <div class="mc-fill" :style="{width: costPct(r.cond)+'%', background: isBestValue(r.cond) ? 'var(--green)' : 'var(--accent)', opacity: isBestValue(r.cond) ? 1 : 0.6}"></div>
            </div>
            <span class="mc-val tt tt-down" style="color:var(--amber);width:52px">
              {{ fmtCost(costByCond[r.cond]) }}
              <span class="tt-body">{{ pctOfTotal(r.cond) }}% of total spend</span>
            </span>
            <span class="mc-val tt tt-down tt-right"
                  :class="isBestValue(r.cond) ? 'rank-eff-best' : 'rank-eff-val'"
                  style="width:52px;font-size:.78rem">
              {{ efficiencyScore(r.cond) }}<span style="font-size:.7em;margin-left:1px">/$</span>
              <span v-if="isBestValue(r.cond)" style="margin-left:2px;font-size:.75em">â˜…</span>
              <span class="tt-body">{{ efficiencyScore(r.cond) }} pts per dollar<br>{{ isBestValue(r.cond) ? 'â˜… Best value condition' : 'Best: '+bestEffCond+' ('+bestEffScore+')' }}</span>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Top samples -->
  <div>
    <div class="sec-hdr">Top Samples to Investigate &nbsp;Â·&nbsp; highest score variance across conditions</div>
    <table class="inv-tbl">
      <thead><tr>
        <th style="width:56px">#</th>
        <th>Question</th>
        <th style="width:64px;text-align:right">
          <span class="tt tt-down">Spread <span class="tt-body">Max composite âˆ’ min composite across conditions. Higher = conditions disagree more.</span></span>
        </th>
        <th style="width:24px"></th>
      </tr></thead>
      <tbody>
        <tr v-for="s in topVariance" :key="s.idx" @click="goSample(s.idx)">
          <td class="inv-idx">#{{ s.idx }}</td>
          <td class="inv-q" :title="s.q">{{ s.q }}</td>
          <td class="inv-delta">Î”{{ s.delta.toFixed(2) }}</td>
          <td style="color:var(--text-m)">â†’</td>
        </tr>
      </tbody>
    </table>
    <button class="ov-all-link" @click="view='smp'">View all {{ sampleIds.length }} samples â†’</button>
  </div>

</div>

<!-- â”€â”€ Samples view â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="v-smp" class="view" :class="{on: loaded && view==='smp'}">

  <!-- List panel -->
  <div id="lst-panel" :class="{collapsed: sidebarCollapsed}">
    <!-- Collapse toggle â€” always visible -->
    <button
      class="lst-collapse-btn"
      @click="sidebarCollapsed = !sidebarCollapsed"
      :title="sidebarCollapsed ? 'Expand sidebar  [' : 'Collapse sidebar  ['"
      :aria-label="sidebarCollapsed ? 'Expand sample list' : 'Collapse sample list'"
    >{{ sidebarCollapsed ? 'â€º' : 'â€¹' }}</button>

    <!-- Vertical label shown when collapsed -->
    <span class="lst-collapsed-label">Samples</span>

    <div class="lst-toolbar">
      <span class="lst-lbl">Sort:</span>
      <select class="lst-sel" v-model="sortMode">
        <option value="variance">Score variance</option>
        <option value="lowest">Lowest score</option>
        <option value="highest">Highest score</option>
        <option value="idx">Sample index</option>
      </select>
    </div>
    <div class="lst-count">{{ sortedIds.length }} samples Â· â†‘â†“ to navigate</div>
    <div id="smp-list" ref="listEl" tabindex="0" @keydown="onKey">
      <div
        class="smp-row"
        :class="{on: selIdx===s.idx}"
        v-for="s in sortedIds"
        :key="s.idx"
        :data-idx="s.idx"
        @click="sel(s.idx)"
      >
        <span class="smp-bullet tt"
              :style="{background: bulletColor(s.best)}"
              >
          <span class="tt-body">Best condition score: {{ s.best.toFixed(2) }}<br>â— â‰¥4.0 green Â· â‰¥3.0 yellow Â· &lt;3.0 red</span>
        </span>
        <span class="smp-idx">#{{ s.idx }}</span>
        <span class="smp-q">{{ s.q }}</span>
        <span class="smp-delta tt tt-right">
          Î”{{ s.delta.toFixed(2) }}
          <span class="tt-body">Score spread: {{ s.delta.toFixed(2) }} pts<br>Max âˆ’ min composite across conditions.</span>
        </span>
      </div>
    </div>
  </div>

  <!-- Detail panel -->
  <div id="det-panel" ref="detEl">
    <div class="det-empty" v-if="!selIdx">â† Select a sample</div>

    <template v-if="selIdx">

      <!-- Back link to Overview -->
      <button class="det-back" @click="view = 'ov'" title="Back to Overview">â† Overview</button>

      <!-- A: Question + Reference -->
      <div class="sec-qa">
        <div class="qa-lbl">Sample #{{ selIdx }} &nbsp;Â·&nbsp; Question</div>
        <div class="qa-q">{{ selQ }}</div>
        <div class="qa-ref">
          <div style="display:flex;align-items:center;gap:10px">
            <button class="ref-toggle" @click="showRef=!showRef">
              {{ showRef ? 'â–´ Hide reference answer' : 'â–¾ Show reference answer' }}
            </button>
            <button v-if="showRef" class="md-toggle" :class="{on: mdRef}" @click="mdRef=!mdRef" title="Toggle markdown rendering">MD</button>
          </div>
          <div class="qa-ref-text md-body" v-if="showRef && mdRef" v-html="md(selRef)"></div>
          <div class="qa-ref-text" v-if="showRef && !mdRef">{{ selRef }}</div>
        </div>
      </div>

      <!-- B: Aggregate score grid -->
      <div class="sec-scores">
        <div class="sec-hdr">Scores by Condition &nbsp;Â·&nbsp; click to inspect</div>
        <div class="score-grid" :style="{gridTemplateColumns: 'repeat('+conditions.length+', 1fr)'}">
          <div
            class="score-col"
            :class="{on: selCond===cond}"
            :style="{borderTopColor: cc(cond)}"
            v-for="(cond, ci) in conditions"
            :key="cond"
            @click="selCond=cond"
          >
            <div class="sc-name" :style="{color: cc(cond)}">
              {{ cond }}
              <span class="sc-star" v-if="isWinner(cond)">
                <span class="tt">â˜…<span class="tt-body">Highest composite score for this sample.</span></span>
              </span>
            </div>
            <div class="sc-comp" :class="sc(compScore(cond))">
              <span class="tt" :class="ci >= conditions.length - 1 ? 'tt-right' : ''">
                {{ compScore(cond).toFixed(1) }}
                <span class="tt-body">
                  Composite: {{ compScore(cond).toFixed(3) }}<br>
                  Avg of factual ({{ mv(cond,'factual_adherence').toFixed(2) }}), completeness ({{ mv(cond,'completeness').toFixed(2) }}), helpfulness ({{ mv(cond,'helpfulness_and_clarity').toFixed(2) }})
                </span>
              </span>
            </div>
            <div class="sc-metrics">
              <div class="sc-m-row" v-for="m in METRICS" :key="m.key">
                <span class="sc-m-lbl tt" :class="ci >= conditions.length - 1 ? 'tt-right' : ''">
                  {{ m.short }}
                  <span class="tt-body">{{ m.def }}</span>
                </span>
                <div class="sc-m-track"><div class="sc-m-fill" :style="{width: bp(mv(cond,m.key))+'%', background: cc(cond)}"></div></div>
                <span class="sc-m-val tt" :class="[sc(mv(cond,m.key)), ci >= conditions.length - 1 ? 'tt-right' : '']">
                  {{ mv(cond,m.key).toFixed(2) }}
                  <span class="tt-body">Mean: {{ mv(cond,m.key).toFixed(3) }} across {{ repCount }} reps<br>Â± {{ sd(cond,m.key).toFixed(3) }} std dev</span>
                </span>
              </div>
              <div class="sc-m-row" style="margin-top:4px;padding-top:4px;border-top:1px solid var(--border)" v-if="sampleCondCost(selIdx, cond) != null">
                <span class="sc-m-lbl tt" :class="ci >= conditions.length - 1 ? 'tt-right' : ''" style="color:var(--text-m)">
                  cost
                  <span class="tt-body">Total agent API cost for this sample Ã— {{ repCount }} reps in {{ cond }}.</span>
                </span>
                <div class="sc-m-track"></div>
                <span class="sc-m-val" style="color:var(--text-m);font-family:var(--mono);font-size:.8rem">
                  {{ fmtCost(sampleCondCost(selIdx, cond)) }}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="spread-line" v-if="spreadDetail">
          Spread: <span class="spread-val tt">{{ spreadDetail.spread.toFixed(2) }} pts
            <span class="tt-body">{{ spreadDetail.max.cond }} ({{ spreadDetail.max.score.toFixed(2) }}) âˆ’ {{ spreadDetail.min.cond }} ({{ spreadDetail.min.score.toFixed(2) }})</span>
          </span>
          &nbsp;Â·&nbsp; {{ spreadLabel }}
        </div>
      </div>

      <!-- C + D: Condition & rep nav + split layout â€” judge section -->
      <div class="judge-section">

        <!-- Condition tabs -->
        <div class="cond-tabs">
          <div
            class="cond-tab tt"
            :class="{on: selCond===cond}"
            v-for="cond in conditions"
            :key="cond"
            @click="selCond=cond"
            :style="selCond===cond ? {color: cc(cond), borderBottomColor: cc(cond)} : {}"
          >
            {{ cond }}
            <span class="tt-body">{{ cond }} Â· {{ repCount }} repetition{{ repCount!==1?'s':'' }}</span>
          </div>
        </div>

        <!-- Rep tabs â€” span full width above the split -->
        <div class="rep-tabs">
          <span class="rep-lbl">Rep:</span>
          <div
            class="rep-tab tt"
            :class="{on: selRep===i}"
            v-for="(_,i) in repCount"
            :key="i"
            @click="selRep=i"
          >
            {{ i+1 }}
            <span class="tt-body">Repetition {{ i+1 }} of {{ repCount }}<br>One independent agent run.</span>
          </div>
        </div>

        <!-- Split: left = agent response, right = judge metrics -->
        <div class="flow-card" v-if="selRecord">

          <!-- Left: Agent response -->
          <div class="flow-left">
            <div class="resp-block">
              <div class="resp-hdr">
                <span class="resp-lbl">Agent Response</span>
                <div style="display:flex;align-items:center;gap:8px">
                  <button class="md-toggle" :class="{on: mdResp}" @click="mdResp=!mdResp" title="Toggle markdown rendering">MD</button>
                  <span class="resp-rep-lbl">Rep {{ selRep+1 }}</span>
                </div>
              </div>
              <!-- Markdown rendered view -->
              <div v-if="mdResp"
                   class="resp-body md-mode md-body"
                   :class="{expanded: respExpanded}"
                   v-html="md(selRecord.run_details[selRep]?.agent_response ?? '')">
              </div>
              <!-- Raw text view -->
              <div v-else
                   class="resp-body"
                   :class="{expanded: respExpanded}">{{ selRecord.run_details[selRep]?.agent_response ?? 'â€”' }}</div>
              <button class="resp-expand-btn" @click="respExpanded=!respExpanded">
                {{ respExpanded ? 'â–´ Collapse' : 'â–¾ Show full response' }}
              </button>
              <div class="resp-footer">
                <span class="tt" v-if="selRecord.run_details[selRep]?.cost_usd != null">
                  Cost: ${{ selRecord.run_details[selRep].cost_usd.toFixed(4) }}
                  <span class="tt-body">Agent API cost for this repetition.</span>
                </span>
                <span class="tt">
                  {{ fmtMs(selRecord.run_details[selRep]?.duration_ms) }}
                  <span class="tt-body">Wall-clock duration for this repetition.</span>
                </span>
                <span>{{ selRecord.run_details[selRep]?.num_turns }} turns</span>
              </div>
            </div>
          </div>

          <!-- Right: Judge metrics -->
          <div class="flow-right">
            <div class="judge-panel-hdr">Judge's Evaluation</div>
            <div class="metric-block" v-for="m in METRICS" :key="m.key">
              <div class="mb-hdr">
                <span class="mb-name tt">
                  {{ m.label }}
                  <span class="tt-body">{{ m.def }}</span>
                </span>
                <div class="mb-track"><div class="mb-fill" :style="{width: bp(mv(selCond,m.key))+'%', background: cc(selCond)}"></div></div>
                <span class="mb-mean tt" :class="sc(mv(selCond,m.key))">
                  {{ mv(selCond,m.key).toFixed(2) }}
                  <span class="tt-body">Mean score across {{ repCount }} repetitions. Score range: 1â€“5.</span>
                </span>
                <span class="mb-std tt" v-if="sd(selCond,m.key)>0">
                  Â±{{ sd(selCond,m.key).toFixed(2) }}
                  <span class="tt-body">Std dev across {{ repCount }} reps. Higher = agent responses varied more between runs.</span>
                </span>
              </div>
              <div class="mb-text">{{ getReasonings(m.key)[selRep] ?? 'â€”' }}</div>
            </div>
          </div>

        </div><!-- /.flow-card -->
      </div><!-- /.judge-section -->

      <!-- E: Unverified claims (all conditions) -->
      <div class="sec-claims" v-if="anyClaimsForSample">
        <div class="sec-hdr">Unverified Claims &nbsp;Â·&nbsp; all conditions</div>
        <div class="claims-grid" :style="{gridTemplateColumns: 'repeat('+conditions.length+', 1fr)'}">
          <div class="claims-cell" v-for="cond in conditions" :key="cond">
            <div class="claims-cond" :style="{color: cc(cond)}">{{ cond }}</div>
            <div v-if="claimsFor(cond).length===0" class="claims-none">âœ“ none</div>
            <div v-else>
              <div class="claim-item" v-for="(c,i) in claimsFor(cond)" :key="i">{{ c }}</div>
            </div>
          </div>
        </div>
      </div>

    </template>
  </div>

</div>
</div>

<script>
// â”€â”€ Data injection point â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.__KEVAL_DATA__ = null;

const { createApp, ref, computed, watch, onMounted, onUnmounted } = Vue;

const CPAL = ['#6b7280','#5b7cf6','#8b5cf6','#10b981','#f59e0b','#ec4899','#ef4444','#06b6d4'];

const METRICS = [
  { key: 'factual_adherence',       label: 'Factual Adherence',    short: 'Factual',   def: 'Does the response contain only claims supported by the reference answer?' },
  { key: 'completeness',            label: 'Completeness',         short: 'Complete',  def: 'Does the response cover all key points in the reference answer?' },
  { key: 'helpfulness_and_clarity', label: 'Helpfulness & Clarity', short: 'Helpful',  def: 'Is the response well-structured, clear, and useful to the end user?' },
];

createApp({
  setup() {
    // â”€â”€ Core state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const records  = ref([]);
    const loaded   = ref(false);
    const view     = ref('ov');
    const dragging = ref(false);
    const loadErr  = ref('');
    const loadMsg  = ref('');
    const sortMode = ref('variance');
    const selIdx   = ref(null);
    const selCond  = ref('');
    const selRep   = ref(0);
    const showRef  = ref(false);
    const respExpanded = ref(false);
    const listEl   = ref(null);
    const detEl    = ref(null);
    const sidebarCollapsed = ref(false);
    const mdResp   = ref(true);   // markdown rendering for agent response
    const mdRef    = ref(true);   // markdown rendering for reference answer

    // â”€â”€ Derived structure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const conditions = computed(() => {
      const s = new Set(records.value.map(r => r.evaluation_name.split('/').slice(1).join('/')));
      return [...s].sort();
    });

    const sampleIds = computed(() => {
      const s = new Set(records.value.map(r => r.sample_idx));
      return [...s].sort((a, b) => +a - +b);
    });

    const byKey = computed(() => {
      const m = {};
      for (const r of records.value) {
        const cond = r.evaluation_name.split('/').slice(1).join('/');
        m[r.sample_idx + '|' + cond] = r;
      }
      return m;
    });

    const evalName = computed(() => records.value[0]?.evaluation_name.split('/')[0] ?? '');
    const modelId  = computed(() => records.value[0]?.model_id ?? '');
    const repCount = computed(() => records.value[0]?.run_details?.length ?? 0);

    // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function cc(cond) { return CPAL[conditions.value.indexOf(cond) % CPAL.length]; }

    function bp(v) { return Math.max(0, Math.min(100, (v / 5) * 100)); }

    function sc(v) { return v >= 4 ? 's-g' : v >= 3 ? 's-y' : 's-r'; }

    function fmtMs(ms) {
      if (ms == null) return 'â€”';
      return ms >= 60000 ? (ms/60000).toFixed(1)+'m' : (ms/1000).toFixed(1)+'s';
    }

    function getRec(idx, cond) { return byKey.value[idx + '|' + cond] ?? null; }

    function comp(rec) {
      if (!rec) return 0;
      const d = rec.evaluation.details;
      return (d.factual_adherence_mean + d.completeness_mean + d.helpfulness_and_clarity_mean) / 3;
    }

    function compScore(cond) { return comp(getRec(selIdx.value, cond)); }

    function mv(cond, key) {
      const rec = getRec(selIdx.value, cond);
      return rec?.evaluation?.details?.[key+'_mean'] ?? 0;
    }

    function sd(cond, key) {
      const rec = getRec(selIdx.value, cond);
      return rec?.evaluation?.details?.[key+'_stddev'] ?? 0;
    }

    function isWinner(cond) {
      const best = Math.max(...conditions.value.map(c => compScore(c)));
      return compScore(cond) >= best - 0.001;
    }

    function bulletColor(best) {
      return best >= 4 ? 'var(--green)' : best >= 3 ? 'var(--yellow)' : 'var(--red)';
    }

    function md(text) {
      if (!text) return '';
      return marked.parse(text, { gfm: true });
    }

    // â”€â”€ Overview computeds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const condRanking = computed(() => {
      return conditions.value.map(cond => {
        const recs = records.value.filter(r => r.evaluation_name.split('/').slice(1).join('/') === cond);
        const vals = recs.map(r => comp(r));
        const mean = vals.length ? vals.reduce((a,b)=>a+b,0)/vals.length : 0;
        return { cond, mean };
      }).sort((a,b) => b.mean - a.mean);
    });

    function ovMetric(cond, key) {
      const recs = records.value.filter(r => r.evaluation_name.split('/').slice(1).join('/') === cond);
      if (!recs.length) return 0;
      const vals = recs.map(r => r.evaluation.details[key+'_mean'] ?? 0);
      return vals.reduce((a,b)=>a+b,0) / vals.length;
    }

    // â”€â”€ Cost computeds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const totalCost = computed(() => {
      let t = 0;
      for (const r of records.value) {
        for (const run of r.run_details ?? []) {
          if (run.cost_usd != null) t += run.cost_usd;
        }
      }
      return t;
    });

    const costByCond = computed(() => {
      const m = {};
      for (const cond of conditions.value) m[cond] = 0;
      for (const r of records.value) {
        const cond = r.evaluation_name.split('/').slice(1).join('/');
        for (const run of r.run_details ?? []) {
          if (run.cost_usd != null) m[cond] = (m[cond] ?? 0) + run.cost_usd;
        }
      }
      return m;
    });

    // Cost for the currently selected sample across all reps for a condition
    function sampleCondCost(idx, cond) {
      const rec = getRec(idx, cond);
      if (!rec) return null;
      let t = 0; let hasAny = false;
      for (const run of rec.run_details ?? []) {
        if (run.cost_usd != null) { t += run.cost_usd; hasAny = true; }
      }
      return hasAny ? t : null;
    }

    function fmtCost(v) {
      if (v == null) return 'â€”';
      if (v >= 1) return '$' + v.toFixed(2);
      return '$' + v.toFixed(4);
    }

    // â”€â”€ Cost efficiency helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function pctOfTotal(cond) {
      const t = totalCost.value;
      if (!t) return '0';
      return ((costByCond.value[cond] / t) * 100).toFixed(0);
    }

    // score per dollar â€” higher is better value
    function efficiencyRaw(cond) {
      const cost = costByCond.value[cond];
      if (!cost) return 0;
      const mean = condRanking.value.find(r => r.cond === cond)?.mean ?? 0;
      return mean / cost;
    }

    function efficiencyScore(cond) {
      return efficiencyRaw(cond).toFixed(2);
    }

    const bestEffCond = computed(() => {
      return conditions.value.reduce((best, c) =>
        efficiencyRaw(c) > efficiencyRaw(best) ? c : best
      , conditions.value[0] ?? '');
    });

    const bestEffScore = computed(() => efficiencyRaw(bestEffCond.value).toFixed(2));

    function isBestValue(cond) { return cond === bestEffCond.value; }

    // efficiency bar width as % of best score/$ (longer = better value)
    function costPct(cond) {
      const maxEff = Math.max(...conditions.value.map(c => efficiencyRaw(c)));
      if (!maxEff) return 0;
      return (efficiencyRaw(cond) / maxEff) * 100;
    }

    function sampleVariance(idx) {
      const scores = conditions.value.map(c => comp(getRec(idx, c)));
      return Math.max(...scores) - Math.min(...scores);
    }

    function sampleBest(idx)  { return Math.max(...conditions.value.map(c => comp(getRec(idx, c)))); }
    function sampleWorst(idx) { return Math.min(...conditions.value.map(c => comp(getRec(idx, c)))); }

    const topVariance = computed(() => {
      return sampleIds.value.map(idx => ({
        idx,
        q: getRec(idx, conditions.value[0])?.input?.raw ?? '',
        delta: sampleVariance(idx),
      })).sort((a,b) => b.delta - a.delta).slice(0, 8);
    });

    // â”€â”€ Sample list â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const sortedIds = computed(() => {
      const items = sampleIds.value.map(idx => ({
        idx,
        q: getRec(idx, conditions.value[0])?.input?.raw?.slice(0,80) ?? '',
        delta: sampleVariance(idx),
        best:  sampleBest(idx),
        worst: sampleWorst(idx),
      }));
      if (sortMode.value === 'variance') return [...items].sort((a,b) => b.delta - a.delta);
      if (sortMode.value === 'lowest')   return [...items].sort((a,b) => a.worst - b.worst);
      if (sortMode.value === 'highest')  return [...items].sort((a,b) => b.best - a.best);
      return [...items].sort((a,b) => +a.idx - +b.idx);
    });

    // â”€â”€ Detail computeds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const selQ    = computed(() => getRec(selIdx.value, conditions.value[0])?.input?.raw ?? '');
    const selRef  = computed(() => getRec(selIdx.value, conditions.value[0])?.input?.reference ?? '');
    const selRecord = computed(() => getRec(selIdx.value, selCond.value));

    const spreadDetail = computed(() => {
      if (!selIdx.value) return null;
      const scored = conditions.value.map(c => ({ cond: c, score: compScore(c) }));
      const max = scored.reduce((a,b) => a.score > b.score ? a : b);
      const min = scored.reduce((a,b) => a.score < b.score ? a : b);
      return { max, min, spread: max.score - min.score };
    });

    const spreadLabel = computed(() => {
      const s = spreadDetail.value?.spread ?? 0;
      return s >= 1.5 ? 'conditions diverge significantly' : s >= 0.7 ? 'moderate spread' : 'conditions perform similarly';
    });

    function getReasonings(key) {
      return selRecord.value?.evaluation?.details?.[key+'_reasonings'] ?? [];
    }

    function claimsFor(cond) {
      return getRec(selIdx.value, cond)?.evaluation?.details?.unverified_claims ?? [];
    }

    const anyClaimsForSample = computed(() => {
      if (!selIdx.value) return false;
      return conditions.value.some(c => claimsFor(c).length > 0);
    });

    // â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function sel(idx) {
      selIdx.value = idx;
      selRep.value = 0;
      showRef.value = false;
      respExpanded.value = false;
      mdResp.value = true;
      mdRef.value = true;

      // default condition = winner
      const winner = conditions.value.reduce((best, c) =>
        comp(getRec(idx, c)) > comp(getRec(idx, best)) ? c : best
      , conditions.value[0]);
      selCond.value = winner;

      // scroll selected row into view
      setTimeout(() => {
        const el = listEl.value?.querySelector('.smp-row.on');
        if (el) el.scrollIntoView({ block: 'nearest' });
        // scroll detail panel to top
        if (detEl.value) detEl.value.scrollTop = 0;
      }, 0);
    }

    function goSample(idx) {
      view.value = 'smp';
      setTimeout(() => sel(idx), 0);
    }

    // Keyboard nav (list-panel focus)
    function onKey(e) {
      if (!['ArrowDown','ArrowUp'].includes(e.key)) return;
      e.preventDefault();
      const ids = sortedIds.value.map(s => s.idx);
      const pos = ids.indexOf(selIdx.value);
      if (e.key === 'ArrowDown') { const n = ids[Math.min(pos+1, ids.length-1)]; if (n) sel(n); }
      if (e.key === 'ArrowUp')   { const n = ids[Math.max(pos-1, 0)];             if (n) sel(n); }
    }

    // Global keyboard shortcuts
    function onGlobalKey(e) {
      // Ignore when focus is on an input/select/textarea
      const tag = document.activeElement?.tagName;
      if (tag === 'INPUT' || tag === 'SELECT' || tag === 'TEXTAREA') return;

      if (e.key === '[' && view.value === 'smp') {
        sidebarCollapsed.value = !sidebarCollapsed.value;
      }
    }

    // Reset rep when condition changes
    watch(selCond, () => { selRep.value = 0; respExpanded.value = false; });

    // â”€â”€ File loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function ingest(recs) {
      records.value = recs;
      loaded.value = true;
      view.value = 'ov';
    }

    function parse(text, name) {
      loadMsg.value = 'Parsingâ€¦'; loadErr.value = '';
      try {
        const recs = text.split('\n').filter(l=>l.trim()).map(l=>JSON.parse(l));
        if (!recs.length) throw new Error('no records');
        ingest(recs);
        loadMsg.value = '';
      } catch(e) {
        loadErr.value = `Could not read ${name} â€” expected .jsonl with evaluation records.`;
        loadMsg.value = '';
      }
    }

    function onDrop(e) {
      dragging.value = false;
      const f = e.dataTransfer.files[0];
      if (f) { const r = new FileReader(); r.onload = ev => parse(ev.target.result, f.name); r.readAsText(f); }
    }

    function onFile(e) {
      const f = e.target.files[0];
      if (f) { const r = new FileReader(); r.onload = ev => parse(ev.target.result, f.name); r.readAsText(f); }
    }

    // â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    onMounted(() => {
      if (window.__KEVAL_DATA__?.length) ingest(window.__KEVAL_DATA__);
      document.addEventListener('keydown', onGlobalKey);
    });

    onUnmounted(() => {
      document.removeEventListener('keydown', onGlobalKey);
    });

    return {
      METRICS,
      records, loaded, view, dragging, loadErr, loadMsg,
      sortMode, selIdx, selCond, selRep, showRef, respExpanded,
      listEl, detEl, sidebarCollapsed,
      conditions, sampleIds, evalName, modelId, repCount,
      condRanking, topVariance, sortedIds,
      selQ, selRef, selRecord, spreadDetail, spreadLabel,
      anyClaimsForSample,
      mdResp, mdRef, md,
      cc, bp, sc, fmtMs, fmtCost, bulletColor,
      totalCost, costByCond, sampleCondCost,
      pctOfTotal, efficiencyScore, isBestValue, bestEffCond, bestEffScore, costPct,
      ovMetric, compScore, mv, sd, isWinner,
      getReasonings, claimsFor,
      sel, goSample, onKey, onDrop, onFile,
    };
  }
}).mount('#app');
</script>
</body>
</html>
